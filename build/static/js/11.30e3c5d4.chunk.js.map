{"version":3,"sources":["components/textAnimation.js","components/useServerData.js","pages/mobileHome.js"],"names":["TextAnimation","texts","breakTime","duration","currentTextIdx","useRef","timer","subTimers","useState","textDisplay","setTextDisplay","useEffect","changeText","clearTimeout","current","length","subTimer","pop","clear","currentText","delta","i","push","setTimeout","substr","useServerData","initialUrl","serverUrl","setServerUrl","serverData","setServerData","fetch","then","res","json","catch","error","alert","console","log","gameStatus","gameStageClass","gameIdxToColor","playerColorCodeOfIdx","MobileHomePage","useDeviceMotion","moveCounter","permissionGranted","setMoveCounter","setPermissionGranted","config","apiUrl","gameStage","setGameStage","stageChanging","setStageChanging","setIsJoined","playerColorCode","setPlayerColorCode","gameSelected","setGameSelected","shakeIconArray","setShakeIconArray","score","setScore","alertText","setAlertText","gameWrapper","socket","playerId","useParams","shake","emit","generateShakeIcon","randomScale","Math","random","randomXStart","randomXEnd","randomY","randomRotationStart","randomRotationEnd","randomDuration","icon","className","styles","colorCodeInHex","initialStyles","bottom","left","transform","opacity","transition","finalStyles","key","Date","now","prevShakeIconArray","slice","requestAnimationFrame","withSocketio","host","socketioHost","eventEmitters","emitter","data","ack","result","eventListeners","listener","callback","stageId","disconnect","round","forEach","player","gameIdx","gameId","document","addEventListener","debugByKeyboard","removeEventListener","event","isJoinedFlag","ref","wrapper","selected","join","d","v","onClick","DeviceMotionEvent","requestPermission","response","buttonsWrapper","Array","fill","map","_","idx","button","newGameIdx","gameButton","floor","toString","split","chr","style","backgroundColor","width","shareToFb","href","window","location","origin","target","dangerouslySetInnerHTML","__html","id"],"mappings":"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","file":"static/js/11.30e3c5d4.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst TextAnimation = ({\r\n  texts,\r\n  // delta = 80,\r\n  breakTime = 1500,\r\n  duration = 1000,\r\n}) => {\r\n  const currentTextIdx = useRef(0);\r\n  const timer = useRef(null);\r\n  const subTimers = useRef([]);\r\n  const [textDisplay, setTextDisplay] = useState(\"\");\r\n  useEffect(() => {\r\n    changeText();\r\n    // timer.current = setTimeout(changeText, duration);\r\n    return () => {\r\n      clearTimeout(timer.current);\r\n      while (subTimers.current.length > 0) {\r\n        const subTimer = subTimers.current.pop();\r\n        clearTimeout(subTimer);\r\n      }\r\n    }\r\n  }, []);\r\n  const changeText = (clear) => {\r\n    if (clear) {\r\n      const currentText = texts[currentTextIdx.current];\r\n      const delta = duration / currentText.length;\r\n      for (let i = 0; i < currentText.length; i++) {\r\n        ((i) => {\r\n          subTimers.current.push(setTimeout(() => {\r\n            setTextDisplay(currentText.substr(0, currentText.length - i - 1));\r\n          }, delta * i));\r\n        })(i)\r\n      }\r\n      timer.current = setTimeout(()=>changeText(), duration);\r\n      // timer.current = setTimeout(changeText, breakTime);\r\n      currentTextIdx.current = (currentTextIdx.current + 1) % texts.length;\r\n      // setTextDisplay(\"\");\r\n    } else {\r\n      const currentText = texts[currentTextIdx.current];\r\n      const delta = duration / currentText.length;\r\n      for (let i = 0; i < currentText.length; i++) {\r\n        ((i) => {\r\n          subTimers.current.push(setTimeout(() => {\r\n            setTextDisplay(currentText.substr(0, i + 1));\r\n          }, delta * i));\r\n        })(i)\r\n      }\r\n      timer.current = setTimeout(()=>changeText(true), duration + breakTime);\r\n    }\r\n  }\r\n  return <>{textDisplay}</>;\r\n}\r\n\r\nexport default TextAnimation;","import React, {useState, useEffect} from 'react';\r\n\r\nconst useServerData = (initialUrl) => {\r\n  const [serverUrl, setServerUrl] = useState(initialUrl);\r\n  const [serverData, setServerData] = useState({});\r\n  useEffect(() => {\r\n    fetch(serverUrl, {\r\n      // mode: 'cors',\r\n      // headers: {\r\n      //   'Content-Type': 'application/json'\r\n      // }\r\n    })\r\n      .then(res => res.json())\r\n      .then(json => setServerData(json))\r\n      .catch(error => alert(error));\r\n  }, [serverUrl]);\r\n  useEffect(() => {\r\n    console.log(serverData);\r\n  }, [serverData])\r\n  return [serverData, setServerUrl];\r\n}\r\n\r\nexport default useServerData;","import React, { useState, useEffect, useRef } from 'react';\r\nimport {useParams} from 'react-router-dom';\r\n// import useDeviceOrientation from 'components/useDeviceOrientation';\r\nimport TextAnimation from 'components/textAnimation';\r\nimport WaitingIcon from 'components/waitingIcon';\r\nimport FanIcon from 'components/fanIcon';\r\nimport FanIconSmall from 'components/fanIconSmall';\r\nimport ShakeIcon from 'components/shakeIcon';\r\n\r\nimport useDeviceMotion from 'components/useDeviceMotion';\r\n\r\nimport withSocketio from 'components/withSocketio';\r\n\r\nimport config from 'globals/config';\r\n\r\nimport styles from './mobileHome.module.css';\r\nimport useServerData from 'components/useServerData';\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\nconst gameStageClass = {\r\n  [gameStatus.idle]:      'stage-idle',\r\n  [gameStatus.waiting]:   'stage-waiting',\r\n  [gameStatus.selecting]: 'stage-selecting',\r\n  [gameStatus.selected]:  'stage-selected',\r\n  [gameStatus.ready]:     'stage-ready',\r\n  [gameStatus.started]:   'stage-started',\r\n  [gameStatus.result]:    'stage-result',\r\n  [gameStatus.offline]:   'stage-offline',\r\n}\r\nconst gameIdxToColor = [\r\n  'red',\r\n  'yellow',\r\n  'blue',\r\n]\r\nconst playerColorCodeOfIdx = [\r\n  \"#ed334e\",\r\n  \"#00652e\",\r\n  \"#0080C7\",\r\n  \"#fbb130\",\r\n  \"#231f20\",\r\n];\r\nconst MobileHomePage = () => {\r\n  const [{moveCounter, permissionGranted}, {setMoveCounter, setPermissionGranted}] = useDeviceMotion();\r\n  const [serverData, setServerUrl] = useServerData(config.apiUrl);\r\n  const [gameStage, setGameStage] = useState(gameStatus['idle']);\r\n  const [stageChanging, setStageChanging] = useState(gameStatus['offline']);\r\n  const [isJoined, setIsJoined] = useState(false);\r\n  const [playerColorCode, setPlayerColorCode] = useState(playerColorCodeOfIdx[0]);\r\n  const [gameSelected, setGameSelected] = useState(-1);\r\n  const [shakeIconArray, setShakeIconArray] = useState([]);\r\n  const [score, setScore] = useState(0);\r\n  const [alertText, setAlertText] = useState('');\r\n\r\n  const gameWrapper = useRef(null);\r\n  const socket = useRef(null);\r\n\r\n  const playerId = useParams('playerId');\r\n\r\n  const setGameWrapper = (ref) => gameWrapper.current = ref;\r\n  const requestPermission = () => {\r\n    if (typeof(DeviceMotionEvent) === \"function\" && typeof(DeviceMotionEvent.requestPermission) === \"function\") {\r\n      DeviceMotionEvent.requestPermission().then(response => {\r\n        if (response == 'granted') {\r\n          setPermissionGranted(true);\r\n          // setGameStage(gameStatus['started']);\r\n        } else {\r\n          alert(\"Please allow the Device Motion to start the game.\\n請允許使用裝置加速計權限以進行遊戲\");\r\n        }\r\n      })\r\n      .catch(console.error);\r\n    } else {\r\n      setPermissionGranted(true);\r\n      // setGameStage(gameStatus['started']);\r\n    }\r\n  };\r\n\r\n  const joinRoom = () => {\r\n    if (!permissionGranted) {\r\n      // setPermissionGranted(true);\r\n      requestPermission();\r\n    } else {\r\n      // socket.current.emit('joinRoom', playerId);\r\n    }\r\n  }\r\n  const selectGame = (gameIdx) => {\r\n    if (socket.current) {\r\n      socket.current.emit('selectGame', {\r\n        data: gameIdx\r\n      }, (data) => {\r\n        const newGameIdx = data['data'];\r\n        setGameSelected(newGameIdx);\r\n      });\r\n    } else {\r\n      if (gameSelected === gameIdx) {\r\n        setGameSelected(-1);\r\n      } else {\r\n        setGameSelected(gameIdx);\r\n      }\r\n    }\r\n  }\r\n\r\n  const shake = () => {\r\n    if (socket.current) {\r\n      socket.current.emit('shake');\r\n    }\r\n    generateShakeIcon();\r\n    // vibration api, ios not support\r\n    // window.navigator.vibrate(100);\r\n  }\r\n  const generateShakeIcon = () => {\r\n    const randomScale = (Math.random() + 8) / 9;\r\n    const randomXStart = Math.random() * 50 - 25;\r\n    const randomXEnd = Math.random() * 30 - 10;\r\n    const randomY = Math.random() * 10 - 5;\r\n    const randomRotationStart = Math.random() * 180 - 90;\r\n    const randomRotationEnd = Math.random() * 90 - 45;\r\n    const randomDuration = Math.random() + 4;\r\n    const icon = <ShakeIcon \r\n      className={styles['shake-icon']} \r\n      colorCodeInHex={playerColorCode}\r\n      initialStyles={{\r\n        bottom: `${60 + randomY}vw`,\r\n        left: `${50 + randomXStart}%`,\r\n        transform: `translateX(-50%) scale(${randomScale}) rotate(${randomRotationStart}DEG)`,\r\n        opacity: 0.8,\r\n        transition: `all ${randomDuration}s`\r\n      }}\r\n      finalStyles={{\r\n        bottom: '100vh',\r\n        left: `${randomXEnd}%`,\r\n        transform: `translateX(-50%) scale(0) rotate(${randomRotationEnd}DEG)`,\r\n        opacity: 0,\r\n        transition: `all ${randomDuration}s`\r\n      }}\r\n      key={Date.now()}\r\n    />;\r\n    setShakeIconArray((prevShakeIconArray) => {\r\n      return [...prevShakeIconArray.slice(-15), icon];\r\n    });\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (moveCounter > 2) {\r\n      shake();\r\n      setMoveCounter(0);\r\n    }\r\n  }, [moveCounter]);\r\n  useEffect(() => {\r\n    requestAnimationFrame(() => {\r\n      setStageChanging(gameStage);\r\n    });\r\n    if (gameStage === gameStatus.ready) {\r\n      setShakeIconArray([]);\r\n    }\r\n  }, [gameStage]);\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      socket.current = withSocketio({\r\n        host: config.socketioHost,\r\n        eventEmitters: [\r\n          {\r\n            emitter: 'joinRoom',\r\n            data: playerId,\r\n            ack: (result) => {\r\n              // alert(result);\r\n              if (result['data'] !== \"joined\") {\r\n                setGameStage(gameStatus.offline);\r\n                setAlertText(result['data']);\r\n              } else {\r\n                setPlayerColorCode(\r\n                  playerColorCodeOfIdx[result['index']]\r\n                );\r\n              }\r\n            }\r\n          }\r\n        ],\r\n        eventListeners: [\r\n          {\r\n            listener: 'gameStage',\r\n            callback: (data) => {\r\n              const stageId = data['data'];\r\n              setGameStage(stageId);\r\n              // if (stageId === gameStatus.selecting) {\r\n              //   setGameSelected(0);\r\n              // } else \r\n              if (stageId === gameStatus.result) {\r\n                socket.current.disconnect();\r\n              }\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameResult',\r\n            callback: (data) => {\r\n              console.log(data);\r\n              const score = data['data'];\r\n              setScore(Math.round(score));\r\n            }\r\n          },\r\n          {\r\n            listener: 'playersInfo',\r\n            callback: (data) => {\r\n              const players = data['data'];\r\n              players.forEach(player => {\r\n                if (player['playerId'] === playerId['playerId']) {\r\n                  setIsJoined(player['joined']);\r\n                }\r\n              });\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameChoice',\r\n            callback: (data) => {\r\n              const gameIdx = data['data'];\r\n              setGameSelected(gameIdx);\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameSelected',\r\n            callback: (data) => {\r\n              const gameId = data['data'];\r\n              setGameSelected(gameId);\r\n              // gameSelected.current = gameId;\r\n            }\r\n          },\r\n        ]\r\n      })\r\n    }\r\n  }, [permissionGranted]);\r\n  useEffect(() => {\r\n    document.addEventListener(\"keyup\", debugByKeyboard);\r\n    return () => {\r\n      document.removeEventListener(\"keyup\", debugByKeyboard);\r\n    }\r\n  }, []);\r\n  const debugByKeyboard = (event) => {\r\n    let isJoinedFlag = true;\r\n    switch (event.key) {\r\n      case \"1\":\r\n        isJoinedFlag = false;\r\n      case \"2\":\r\n      case \"3\":\r\n        setGameSelected(-1);\r\n      case \"4\":\r\n      case \"5\":\r\n      case \"6\":\r\n      case \"7\":\r\n        setGameStage(event.key - 1);\r\n        setIsJoined(isJoinedFlag);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  return (\r\n    <div ref={setGameWrapper} className={styles.wrapper}>\r\n      <div className={[styles['stage'], styles[gameStageClass[gameStage]], (stageChanging === gameStage? styles['active']: null), (gameSelected !== -1? styles.selected: null)].join(' ')}>\r\n        <div className={styles[\"background\"]}>\r\n          <div className={styles[\"texture\"]} />\r\n        </div>\r\n        <div className={[styles[\"marquee\"], styles[\"marqueeTop\"], styles[\"marqueeIdle\"]].join(' ')} />\r\n        <div className={[styles[\"marquee\"], styles[\"marqueeLeft\"], styles[\"marqueeIdle\"]].join(' ')} />\r\n        <div className={[styles[\"marquee\"], styles[\"marqueeBottom\"], styles[\"marqueeIdle\"]].join(' ')} />\r\n        <div className={[styles[\"marquee\"], styles[\"marqueeRight\"], styles[\"marqueeIdle\"]].join(' ')} />\r\n        {gameStage === gameStatus.idle && <>\r\n          <div className={styles[\"title\"]} />\r\n          <div className={[styles[\"counter\"], styles[\"counter1\"]].join(' ')}>\r\n            <span>{serverData.d}</span> km\r\n            <div className={styles[\"counterHints\"]}>\r\n              <TextAnimation \r\n                texts={[\r\n                  \"累積距離\",\r\n                  \"Cumulative distance\"\r\n                ]}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className={[styles[\"counter\"], styles[\"counter2\"]].join(' ')}>\r\n            <span>{serverData.v}</span>\r\n            <div className={styles[\"counterHints\"]}>\r\n              <TextAnimation \r\n                texts={[\r\n                  \"累積人數\",\r\n                  \"Cumulative visits\"\r\n                ]}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className={styles[\"logo\"]} />\r\n          <div className={styles[\"join-game-button\"]} onClick={joinRoom}>\r\n            <div className={styles[\"face\"]}>\r\n              <TextAnimation \r\n                texts={[\r\n                  \"立即參加\",\r\n                  \"Join game\"\r\n                ]}\r\n              />\r\n            </div>\r\n            <div className={styles[\"shadow\"]} />\r\n          </div>\r\n        </>}\r\n        {gameStage === gameStatus.waiting && <>\r\n          <WaitingIcon className={[styles[\"movingIcon\"], styles[\"movingIcon1\"]].join(' ')} colorCodeInHex={playerColorCode} />\r\n          <WaitingIcon className={[styles[\"movingIcon\"], styles[\"movingIcon2\"]].join(' ')} colorCodeInHex={playerColorCode} />\r\n          <WaitingIcon className={[styles[\"movingIcon\"], styles[\"movingIcon3\"]].join(' ')} colorCodeInHex={playerColorCode} />\r\n          <WaitingIcon className={[styles[\"movingIcon\"], styles[\"movingIcon4\"]].join(' ')} colorCodeInHex={playerColorCode} />\r\n        </>}\r\n        {gameStage === gameStatus.selecting && <>\r\n          <div className={[styles.buttonsWrapper, (gameSelected !== -1? styles.selected: null)].join(' ')}>\r\n            {\r\n              new Array(3).fill(0).map((_, idx) => {\r\n                return (\r\n                  <div className={styles.button}>\r\n                    <button onClick={()=>selectGame(idx)} \r\n                      className={[styles.gameButton, styles[`gameButton${idx}`], (gameSelected === idx? styles.selected: null)].join(' ')}>\r\n                      <div className={styles[\"contentWrapper\"]}>\r\n                        <div className={styles[\"zh\"]} />\r\n                        <div className={styles[\"en\"]} />\r\n                        <div className={styles[\"ani\"]} />\r\n                      </div>\r\n                    </button>\r\n                  </div>\r\n                );\r\n              })\r\n            }\r\n            <div className={[styles['gacha'], styles['red']].join(' ')}>\r\n              <div className={styles['gachaTop']} />\r\n              <div className={styles['gachaBottom']} />\r\n            </div>\r\n            <div className={[styles['gacha'], styles['yellow']].join(' ')}>\r\n              <div className={styles['gachaTop']} />\r\n              <div className={styles['gachaBottom']} />\r\n            </div>\r\n            <div className={[styles['gacha'], styles['blue']].join(' ')}>\r\n              <div className={styles['gachaTop']} />\r\n              <div className={styles['gachaBottom']} />\r\n            </div>\r\n          </div>\r\n        </>}\r\n        {gameStage === gameStatus.selected && <>\r\n          <div className={[styles['title']].join(' ')}></div>\r\n          <div className={[styles[\"gameName\"], styles[`game${gameSelected}`]].join(' ')}>\r\n            <div className={styles[\"loading\"]}>Loading...</div>\r\n            <div className={styles[\"zh\"]} />\r\n            <div className={styles[\"en\"]} />\r\n          </div>\r\n          <div className={[styles['gacha'], styles['selected'], styles[gameIdxToColor[gameSelected]]].join(' ')}>\r\n            <div className={styles['gachaTop']} />\r\n            <div className={styles['gachaBottom']} />\r\n          </div>\r\n          <div className={[styles['resultWrapper']].join(' ')}>\r\n            <div className={[styles['result'], styles[`result${gameSelected}`]].join(' ')} />\r\n          </div>\r\n        </>}\r\n        {(gameStage === gameStatus.ready || gameStage === gameStatus.started) && <>\r\n          <div className={styles[\"get-image\"]} />\r\n          <div className={styles[\"set-image\"]} />\r\n          <div className={styles[\"go-image\"]} />\r\n          <div onClick={shake}>\r\n            <FanIcon className={[styles[\"fanIcon\"]].join(' ')} colorCodeInHex={playerColorCode} />\r\n          </div>\r\n          {shakeIconArray}\r\n        </>}\r\n        {gameStage === gameStatus.result && <>\r\n          <div className={styles[\"background\"]}>\r\n            <div className={styles[\"texture\"]} />\r\n          </div>\r\n          <div className={styles[\"splashScreen\"]}>\r\n            {new Array(10).fill(0).map((_, idx) => {\r\n              return <div className={[styles[\"banner-wrapper\"], styles[`bannerLot${Math.floor(idx / 5)}`], styles[`bannerType${idx % 5}`]].join(' ')}>\r\n                <div className={styles[\"banner\"]} />\r\n              </div>;\r\n            })}\r\n          </div>\r\n          <div className={styles[\"title\"]} />\r\n          <div className={styles[\"header\"]} />\r\n          <div className={[styles[\"score\"], styles[`digit${score.toString().split('').length}`]].join(' ')}>\r\n            {score.toString().split('').map((chr, idx) => {\r\n              return <span key={idx} className={[styles[\"number\"], styles[`number${chr}`]].join(' ')} />;\r\n            })}\r\n            <div className={styles[\"unit\"]}>km</div>\r\n            <div className={styles[\"remain\"]}>\r\n              <div className={styles[\"zh\"]}>{2884 - score}</div>\r\n              <div className={styles[\"en\"]}>{2884 - score} to go</div>\r\n            </div>\r\n          </div>\r\n          <div className={styles[\"bar-chart\"]}>\r\n            <div className={styles[\"bar\"]} style={{\r\n              backgroundColor: playerColorCode,\r\n              width: `${(stageChanging === gameStatus.result? Math.random() * 50 + 50: 0)}%`\r\n            }} />\r\n            <FanIconSmall className={styles[\"icon\"]} colorCodeInHex={playerColorCode} />\r\n          </div>\r\n          <div className={[styles[\"selected\"], styles[`selected${gameSelected}`]].join(' ')} />\r\n          <a className={styles.shareToFb} href={`https://www.facebook.com/sharer/sharer.php?u=${window.location.origin}&quote=I played Shake Shake Game and got ${score} marks !`} target=\"_blank\">\r\n            <div className={styles[\"zh\"]} />\r\n            <div className={styles[\"en\"]} />\r\n          </a>\r\n        </>}\r\n        {gameStage === gameStatus.offline && <>\r\n          <div className={styles[\"alertText\"]} dangerouslySetInnerHTML={{\r\n            __html: alertText\r\n          }} />\r\n        </>\r\n        }\r\n        <div id={styles[\"debug\"]}>\r\n        {moveCounter}\r\n        <br />\r\n        {gameStage}\r\n        <br />\r\n        {serverData.d + ' ' + serverData.v}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MobileHomePage;"],"sourceRoot":""}