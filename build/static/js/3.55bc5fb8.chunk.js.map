{"version":3,"sources":["containers/gameCanvas.module.css","components/withSocketio.js","globals/config.js","containers/debugPanel.js","media/sprite/offline-sprite-2x.png","containers/debugPanel.module.css","containers/gameCanvas.js"],"names":["module","exports","withSocketio","host","eventListeners","eventEmitters","socket","io","secure","on","console","log","forEach","event","ack","emit","emitter","data","listener","callback","config","socketioHost","apiUrl","playerColor","gameStatus","gameStatusText","distanceMultipliersOptions","DebugPanel","useState","gameStage","setGameStage","joinGamePaths","setJoinGamePaths","roomList","setRoomList","qrcodeArray","setQrcodeArray","playersInfo","setPlayersInfo","Array","fill","scoreArray","setScoreArray","choicesArray","setChoicesArray","gameSelected","setGameSelected","distanceMultiplier","setDistanceMultiplier","roomId","useParams","tempScoreArray","useRef","useEffect","current","result","isArray","stageId","additionalParams","i","length","tempQrcodeArray","playerInfo","idx","joinGamePath","window","location","origin","generatePath","routes","mobileHome","playerId","prevJoinGamePaths","newJoinGamePaths","QRCode","toDataURL","margin","width","color","dark","err","url","gameId","shakeArray","score","newDistanceMultiplier","newRoomList","disconnect","joinGame","playerIdx","type","kickPlayer","doShake","playerSelectGame","gameIdx","selectedArray","className","styles","debugPanel","header","undefined","to","debug","backToList","title","row","value","onChange","newStage","target","Object","keys","map","status","key","distanceMultiplierOptions","href","qrblock","onClick","e","preventDefault","src","qrplaceholder","style","joined","playerJoined","gameSelectingBtn","playerNotJoined","roomItemWrap","roomItem","split","waitingTimer","cloudPos","birdPos","floorPos","TrexPos","cactusPos","GameCanvas","cachedCanvas","cacheCanvas","document","createElement","cacheCtx","getContext","spriteImage","Image","addEventListener","height","drawImage","once","spriteImageUrl","CachedCanvas","canvas","ctx","animationFrame","history","useHistory","cloudArray","birdArray","cactusArray","shakeCounter","backgroundTimer","timeStarted","roomName","drawTrex","drawTimer","total","delta","Date","now","timeRemainString","Math","max","toString","padStart","save","font","fillStyle","fillText","restore","drawFloor","targetX","remainX","drawScore","scoreString","textAlign","prevTime","drawCactus","cactus","timeDelta","globalAlpha","needAnimate","min","fillRect","addShakeCounter","count","render","requestAnimationFrame","clearRect","qrcode","drawLanding","cloudOffset","newX","filter","el","currentFrame","birdOffset","drawBird","push","random","drawResult","newRoomName","home","dummyCanvas","toCanvas","countArray","countSum","reduce","accumulator","currentValue","addScore","finalScore","cancelAnimationFrame","gameCanvasWrapper","gameCanvas","ref","canvasRef","offsetWidth","offsetHeight","fullscreenIcon","requestFullscreen"],"mappings":"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","file":"static/js/3.55bc5fb8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"gameCanvasWrapper\":\"gameCanvas_gameCanvasWrapper__24jRb\",\"gameCanvas\":\"gameCanvas_gameCanvas__1a-JZ\",\"fullscreenIcon\":\"gameCanvas_fullscreenIcon__1_V4H\"};","import io from 'socket.io-client';\r\n\r\nconst withSocketio = ({\r\n  host,\r\n  eventListeners,\r\n  eventEmitters\r\n}) => {\r\n  const socket = io(host, {secure: false});\r\n  \r\n  // console.log(socket);\r\n  \r\n  socket.on('connect', () => {\r\n    console.log('connected !');\r\n    // socket.emit('joinRoom', props.match.match.params.userId);\r\n    // wait join result msg from server\r\n    eventEmitters.forEach(event => {\r\n      const ack = (typeof(event.ack) === \"function\"? event.ack: null);\r\n      socket.emit(event.emitter, event.data, ack);\r\n    });\r\n  });\r\n\r\n  eventListeners.forEach(event => {\r\n    socket.on(event.listener, event.callback);\r\n  });\r\n\r\n  return socket;\r\n}\r\n\r\nexport default withSocketio;","const config = {\r\n  socketioHost: 'shakeshakegame.herokuapp.com',\r\n  // socketioHost: '10.0.1.40:3000',\r\n  apiUrl: 'https://10.0.1.40:3005/data'\r\n};\r\n\r\nexport default config;","import React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport {useParams, generatePath, Link} from 'react-router-dom';\r\nimport QRCode from 'qrcode';\r\n\r\nimport withSocketio from 'components/withSocketio';\r\n\r\nimport routes from 'globals/routes';\r\nimport config from 'globals/config';\r\n\r\nimport spriteImageUrl from 'media/sprite/offline-sprite-2x.png';\r\n\r\nimport styles from './debugPanel.module.css';\r\n\r\nconst playerColor = [\r\n  \"#ed334e\",\r\n  \"#00652e\",\r\n  \"#0080C7\",\r\n  \"#fbb130\",\r\n  \"#231f20\",\r\n];\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\n\r\nconst gameStatusText = {\r\n  [gameStatus.idle]:      'idle',\r\n  [gameStatus.waiting]:   'waiting',\r\n  [gameStatus.selecting]: 'selecting',\r\n  [gameStatus.selected]:  'selected',\r\n  [gameStatus.ready]:     'ready',\r\n  [gameStatus.started]:   'started',\r\n  [gameStatus.result]:    'result',\r\n  [gameStatus.offline]:   'offline',\r\n};\r\n\r\nconst distanceMultipliersOptions = [\r\n  0.1,\r\n  1,\r\n  2,\r\n  5,\r\n  10,\r\n  20,\r\n  50,\r\n  100\r\n];\r\nconst cactusPos = [\r\n  446, 2, 34, 70\r\n];\r\n\r\n// const CachedCanvas = () => {\r\n//   const cacheCanvas = document.createElement('canvas');\r\n//   const cacheCtx = cacheCanvas.getContext('2d');\r\n//   const spriteImage = new Image();\r\n//   spriteImage.addEventListener('load', () => {\r\n//     cacheCanvas.width = spriteImage.width;\r\n//     cacheCanvas.height = spriteImage.height;\r\n//     cacheCtx.drawImage(spriteImage, 0, 0);\r\n//   }, {\r\n//     once: true\r\n//   });\r\n//   spriteImage.src = spriteImageUrl;\r\n//   return cacheCanvas;\r\n// }\r\n\r\nconst DebugPanel = () => {\r\n  const [gameStage, setGameStage] = useState(gameStatus.offline);\r\n  // const cachedCanvas = CachedCanvas();\r\n  const [joinGamePaths, setJoinGamePaths] = useState([]);\r\n  const [roomList, setRoomList] = useState([]);\r\n  const [qrcodeArray, setQrcodeArray] = useState([]);\r\n  const [playersInfo, setPlayersInfo] = useState([]);\r\n  const [scoreArray, setScoreArray] = useState(new Array(5).fill(0));\r\n  const [choicesArray, setChoicesArray] = useState(new Array(5).fill(-1));\r\n  const [gameSelected, setGameSelected] = useState(0);\r\n  const [distanceMultiplier, setDistanceMultiplier] = useState(1);\r\n  const {roomId} = useParams();\r\n\r\n  // const roomName \r\n  const tempScoreArray = [0, 0, 0, 0, 0];\r\n  const socket = useRef(null);\r\n  useEffect(() => {\r\n    socket.current = withSocketio({\r\n      host: config.socketioHost,\r\n      eventEmitters: [\r\n        {\r\n          emitter: 'debugRoom',\r\n          data: {\r\n            roomId: roomId\r\n          },\r\n          ack: (result) => {\r\n            console.log(result['data']);\r\n            if (Array.isArray(result['data'])) {\r\n              setRoomList(result['data']);\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      eventListeners: [\r\n        {\r\n          listener: 'disconnect',\r\n          callback: () => console.log('disconnect!')\r\n        },\r\n        // {\r\n        //   listener: 'roomCreated',\r\n        //   callback: (roomName) => {\r\n        //     roomCreated\r\n        //   }\r\n        // },\r\n        {\r\n          listener: 'gameStage',\r\n          callback: (data) => {\r\n            const stageId = data['data'];\r\n            const additionalParams = data['playersInfo'];\r\n            console.log('gameStage', stageId, additionalParams);\r\n            setGameStage(stageId);\r\n            if (stageId === gameStatus.started) {\r\n              for (let i = 0; i < tempScoreArray.length; i++) {\r\n                tempScoreArray[i] = 0;\r\n              }\r\n              setScoreArray(new Array(5).fill(0));\r\n            } else if (stageId === gameStatus.selecting) {\r\n              setChoicesArray(new Array(5).fill(-1));\r\n            }\r\n          }\r\n        },\r\n        {\r\n          listener: 'playersInfo',\r\n          callback: (data) => {\r\n            const playersInfo = data['data'];\r\n            console.log('playersInfo', playersInfo);\r\n            setPlayersInfo(playersInfo);\r\n            const tempQrcodeArray = [];\r\n            playersInfo.forEach((playerInfo, idx) => {\r\n              if (playerInfo['joined'] === false) {\r\n                const joinGamePath = window.location.origin + generatePath(routes.mobileHome, {playerId: playerInfo['playerId']});\r\n                // 1234\r\n                setJoinGamePaths((prevJoinGamePaths) => {\r\n                  const newJoinGamePaths = [...prevJoinGamePaths];\r\n                  newJoinGamePaths[idx] = joinGamePath;\r\n                  return newJoinGamePaths;\r\n                });\r\n                QRCode.toDataURL(\r\n                  joinGamePath,\r\n                  {\r\n                    margin: 0,\r\n                    width: 150,\r\n                    color: {\r\n                      dark: playerColor[idx],\r\n                    }\r\n                  }, (err, url) => {\r\n                    tempQrcodeArray[idx] = url;\r\n                    setQrcodeArray([...tempQrcodeArray]);\r\n                  }\r\n                );\r\n              } else {\r\n                tempQrcodeArray[idx] = null;\r\n                setQrcodeArray([...tempQrcodeArray]);\r\n              }\r\n            })\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameChoices',\r\n          callback: (data) => {\r\n            const choicesArray = data['data'];\r\n            console.log('gameChoices', choicesArray);\r\n            setChoicesArray(choicesArray);\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameSelected',\r\n          callback: (data) => {\r\n            const gameId = data['data'];\r\n            console.log('gameSelected', gameId);\r\n            setGameSelected(gameId);\r\n          }\r\n        },\r\n        {\r\n          listener: 'playersShake',\r\n          callback: (data) => {\r\n            const shakeArray = data['data'];\r\n            console.log('playersShake', shakeArray);\r\n            // const tempScoreArray = [...scoreArray];\r\n            shakeArray.forEach((score, idx) => {\r\n              // if (tempScoreArray[idx] === undefined) {\r\n              //   tempScoreArray[idx] = score;\r\n              // } else {\r\n              tempScoreArray[idx] += score;\r\n              // }\r\n            })\r\n            setScoreArray([...tempScoreArray]);\r\n          }\r\n        },\r\n        {\r\n          listener: 'updateDistanceMultiplier',\r\n          callback: (newDistanceMultiplier) => {\r\n            console.log('updateDistanceMultiplier', newDistanceMultiplier);\r\n            setDistanceMultiplier(newDistanceMultiplier);\r\n          }\r\n        },\r\n        {\r\n          listener: 'roomList',\r\n          callback: (newRoomList) => {\r\n            console.log('roomList', newRoomList);\r\n            if (Array.isArray(newRoomList)) {\r\n              setRoomList(newRoomList);\r\n            }\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameResult',\r\n          callback: (result) => {\r\n            console.log('gameResult', result);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    return () => {\r\n      if (socket.current) {\r\n        socket.current.disconnect();\r\n      }\r\n    }\r\n  }, [roomId])\r\n  const changeGameStatus = (event) => {\r\n    const newStage = event.target.value;\r\n    setGameStage(newStage);\r\n    socket.current.emit('debug', {\r\n      type: 'gameStage',\r\n      data: newStage\r\n    });\r\n  }\r\n  const changeDistanceMultiplier = (event) => {\r\n    const newDistanceMultiplier = event.target.value;\r\n    setDistanceMultiplier(newDistanceMultiplier);\r\n    socket.current.emit('debug', {\r\n      type: 'setDistanceMultiplier',\r\n      data: newDistanceMultiplier\r\n    });\r\n  }\r\n  const joinGame = (playerIdx) => {\r\n    const playerId = playersInfo[playerIdx]['playerId'];\r\n    socket.current.emit('debug', {\r\n      type: 'joinGame',\r\n      data: {\r\n        playerId: playerId\r\n      }\r\n    });\r\n  }\r\n  const kickPlayer = (playerIdx) => {\r\n    const playerId = playersInfo[playerIdx]['playerId'];\r\n    socket.current.emit('debug', {\r\n      type: 'kickPlayer',\r\n      data: {\r\n        playerId: playerId\r\n      }\r\n    });\r\n  }\r\n  const doShake = (playerIdx) => {\r\n    const playerId = playersInfo[playerIdx]['playerId'];\r\n    socket.current.emit('debug', {\r\n      type: 'shake',\r\n      data: {\r\n        playerId: playerId\r\n      }\r\n    });\r\n  }\r\n  const playerSelectGame = (playerIdx, gameIdx) => {\r\n    choicesArray[playerIdx] = gameIdx;\r\n    socket.current.emit('debug', {\r\n      type: 'selectGame',\r\n      data: {\r\n        selectedArray: choicesArray\r\n      }\r\n    });\r\n  }\r\n  return (\r\n  <div className={styles.debugPanel}>\r\n    <div className={styles.header}>Debug Panel - Room \r\n      {roomId !== undefined && \r\n        <>\r\n          &nbsp;\r\n          <Link to={generatePath(routes.debug)} className={styles.backToList} />\r\n          <span className={styles.roomId} title={`Room Id: ${roomId}`}>{roomId}</span>\r\n        </>\r\n      }\r\n    </div>\r\n    {roomId !== undefined ?\r\n      <>\r\n        <div className={styles.row}>\r\n          Game Stage: &nbsp;\r\n          <select value={gameStage} onChange={changeGameStatus}>\r\n            {Object.keys(gameStatusText).map(status => {\r\n              return <option key={status} value={status}>{gameStatusText[status]}</option>\r\n            })}\r\n          </select>\r\n        </div>\r\n        <div className={styles.row}>\r\n          Distance Multiplier: &nbsp;\r\n          <select value={distanceMultiplier} onChange={changeDistanceMultiplier}>\r\n            {distanceMultipliersOptions.map(distanceMultiplierOptions => {\r\n              return <option key={distanceMultiplierOptions} value={distanceMultiplierOptions}>{distanceMultiplierOptions}</option>\r\n            })}\r\n          </select>\r\n        </div>\r\n        {{\r\n          [gameStatus.idle]: (\r\n            <div className={styles.row}>\r\n              {qrcodeArray.map((url, idx) => {\r\n                if (url !== null) {\r\n                  return <a key={idx} href={joinGamePaths[idx]} className={styles.qrblock} onClick={(e) => {\r\n                    e.preventDefault();\r\n                    joinGame(idx);\r\n                  }}>\r\n                    <img src={url}  />\r\n                    <div>Use this</div>\r\n                  </a>;\r\n                } else {\r\n                  return <div key={idx} className={styles.qrblock} onClick={() => kickPlayer(idx)}>\r\n                    <div className={styles.qrplaceholder} style={{\r\n                      color: playerColor[idx]\r\n                    }}>\r\n                      Joined\r\n                    </div>\r\n                    <div>Kick this</div>\r\n                  </div>;\r\n                }\r\n              })}\r\n            </div>\r\n          ),\r\n          [gameStatus.waiting]: (\r\n            <div className={styles.row}>\r\n              {qrcodeArray.map((url, idx) => {\r\n                if (url !== null) {\r\n                  return <a key={idx} href={joinGamePaths[idx]} className={styles.qrblock} onClick={(e) => {\r\n                    e.preventDefault();\r\n                    joinGame(idx);\r\n                  }}>\r\n                    <img src={url}  />\r\n                    <div>Use this</div>\r\n                  </a>;\r\n                } else {\r\n                  return <div key={idx} className={styles.qrblock} onClick={() => kickPlayer(idx)}>\r\n                    <div className={styles.qrplaceholder} style={{\r\n                      color: playerColor[idx]\r\n                    }}>\r\n                      Joined\r\n                    </div>\r\n                    <div>Kick this</div>\r\n                  </div>;\r\n                }\r\n              })}\r\n            </div>\r\n          ),\r\n          [gameStatus.selecting]: (\r\n            <div className={styles.row}>\r\n              {playersInfo.map((playerInfo, idx) => {\r\n                if (playerInfo.joined) {\r\n                  return <div key={idx} className={styles.playerJoined} onClick={() => doShake(idx)} style={{\r\n                    color: playerColor[idx]\r\n                  }}>\r\n                    <button onClick={()=>playerSelectGame(idx, 0)} className={styles.gameSelectingBtn + (choicesArray[idx] === 0? ' ' + styles.gameSelected: '')}>Game 1</button>\r\n                    <button onClick={()=>playerSelectGame(idx, 1)} className={styles.gameSelectingBtn + (choicesArray[idx] === 1? ' ' + styles.gameSelected: '')}>Game 2</button>\r\n                    <button onClick={()=>playerSelectGame(idx, 2)} className={styles.gameSelectingBtn + (choicesArray[idx] === 2? ' ' + styles.gameSelected: '')}>Game 3</button>\r\n                  </div>;\r\n                } else {\r\n                  return <div key={idx} className={styles.playerNotJoined} style={{\r\n                    color: playerColor[idx]\r\n                  }}>\r\n                    <div>Not Joined</div>\r\n                  </div>;\r\n                }\r\n              })}\r\n            </div>\r\n          ),\r\n          [gameStatus.selected]: (\r\n            <div className={styles.row}>\r\n              Game {gameSelected + 1}\r\n            </div>\r\n          ),\r\n          [gameStatus.started]: (\r\n            <div className={styles.row}>\r\n              {playersInfo.map((playerInfo, idx) => {\r\n                if (playerInfo.joined) {\r\n                  return <div key={idx} className={styles.playerJoined} onClick={() => doShake(idx)} style={{\r\n                    color: playerColor[idx]\r\n                  }}>\r\n                    <div>Shake</div>\r\n                    <div>{scoreArray[idx]}</div>\r\n                  </div>;\r\n                } else {\r\n                  return <div key={idx} className={styles.playerNotJoined} style={{\r\n                    color: playerColor[idx]\r\n                  }}>\r\n                    <div>Not Joined</div>\r\n                  </div>;\r\n                }\r\n              })}\r\n            </div>\r\n          ),\r\n        }[gameStage]}\r\n      </>\r\n      :\r\n      <>\r\n        {\r\n          roomList.length > 0 ?\r\n            <div className={styles.roomItemWrap}>\r\n              {roomList.map((roomId) => {\r\n                return <Link key={roomId} to={generatePath(routes.debug, { roomId: roomId })} className={styles.roomItem}>{roomId.split('-')[0]}</Link>\r\n              })}\r\n            </div>\r\n          :\r\n            <div className={styles.row}>\r\n              No Game is Running\r\n            </div>\r\n        }\r\n      </>\r\n    }\r\n  </div>);\r\n};\r\n\r\nexport default DebugPanel;","module.exports = \"data:image/png;base64,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\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"debugPanel\":\"debugPanel_debugPanel__3MTTn\",\"header\":\"debugPanel_header__18Ub2\",\"row\":\"debugPanel_row__3Bl3F\",\"roomId\":\"debugPanel_roomId__3o3yP\",\"backToList\":\"debugPanel_backToList__3dbgt\",\"qrblock\":\"debugPanel_qrblock__1YTKB\",\"qrplaceholder\":\"debugPanel_qrplaceholder__3hrn6\",\"playerJoined\":\"debugPanel_playerJoined__KgOtU\",\"playerNotJoined\":\"debugPanel_playerNotJoined__2pYTa\",\"gameSelectingBtn\":\"debugPanel_gameSelectingBtn__3PfEG\",\"gameSelected\":\"debugPanel_gameSelected__dKF6c\",\"roomItemWrap\":\"debugPanel_roomItemWrap__3xk8X\",\"roomItem\":\"debugPanel_roomItem__3Y__k\"};","import React, { useEffect, useState, useRef } from 'react';\r\nimport {useHistory, useParams, generatePath} from 'react-router-dom';\r\nimport QRCode from 'qrcode';\r\n\r\nimport withSocketio from 'components/withSocketio';\r\n\r\nimport routes from 'globals/routes';\r\nimport config from 'globals/config';\r\n\r\nimport spriteImageUrl from 'media/sprite/offline-sprite-2x.png';\r\n\r\nimport styles from './gameCanvas.module.css';\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\nconst waitingTimer = {\r\n  // [gameStatus.idle]:    5,\r\n  // [gameStatus.waiting]: 30,\r\n  // [gameStatus.ready]:   3,\r\n  // [gameStatus.started]: 60,\r\n  // [gameStatus.result]:  30,\r\n  // [gameStatus.offline]: 5,\r\n  [gameStatus.idle]:      -1,\r\n  [gameStatus.waiting]:   20,\r\n  [gameStatus.selecting]: 10,\r\n  [gameStatus.selected]:  5,\r\n  [gameStatus.ready]:     5,\r\n  [gameStatus.started]:   30,\r\n  [gameStatus.result]:    10,\r\n  [gameStatus.offline]:   -1,\r\n};\r\nconst fps = 60;\r\n\r\nconst playerColor = [\r\n  '#0885c2',\r\n  '#fbb132',\r\n  '#000000',\r\n  '#1c8b3c',\r\n  '#ed334e'\r\n];\r\nconst numPos = [\r\n  [954, 2, 18, 21],\r\n  [974, 2, 18, 21],\r\n  [994, 2, 18, 21],\r\n  [1014, 2, 18, 21],\r\n  [1034, 2, 18, 21],\r\n  [1054, 2, 18, 21],\r\n  [1074, 2, 18, 21],\r\n  [1094, 2, 18, 21],\r\n  [1114, 2, 18, 21],\r\n  [1134, 2, 18, 21]\r\n]\r\nconst cloudPos = [\r\n  166, 2, 92, 27\r\n];\r\nconst birdPos = [\r\n  [260, 2, 92, 80],\r\n  [352, 2, 92, 80],\r\n];\r\nconst floorPos = [\r\n  2, 104, 2400, 26\r\n];\r\nconst TrexPos = [\r\n  [1338, 2, 88, 94],\r\n  [1426, 2, 88, 94],\r\n  [1514, 2, 88, 94],\r\n  [1602, 2, 88, 94],\r\n  [1690, 2, 88, 94],\r\n  [1778, 2, 88, 94],\r\n  [1866, 2, 118, 94],\r\n  [1984, 2, 118, 94],\r\n];\r\nconst cactusPos = [\r\n  446, 2, 34, 70\r\n];\r\nconst CachedCanvas = () => {\r\n  const cacheCanvas = document.createElement('canvas');\r\n  const cacheCtx = cacheCanvas.getContext('2d');\r\n  const spriteImage = new Image();\r\n  spriteImage.addEventListener('load', () => {\r\n    cacheCanvas.width = spriteImage.width;\r\n    cacheCanvas.height = spriteImage.height;\r\n    cacheCtx.drawImage(spriteImage, 0, 0);\r\n  }, {\r\n    once: true\r\n  });\r\n  spriteImage.src = spriteImageUrl;\r\n  return cacheCanvas;\r\n}\r\nconst GameCanvas = () => {\r\n  const [gameStage, setGameStage] = useState(gameStatus.offline);\r\n\r\n  const cachedCanvas = CachedCanvas();\r\n  const canvas = useRef();\r\n  const ctx = useRef();\r\n  const animationFrame = useRef();\r\n\r\n  const {roomId} = useParams();\r\n\r\n  const qrcodeArray = useRef([]);\r\n  const playerJoined = useRef([]);\r\n  let history = useHistory();\r\n  let cloudArray = [];\r\n  let birdArray = [];\r\n  let cactusArray = useRef([0,0,0,0,0]);\r\n  const setGameCanvas = canvasRef => {\r\n    canvas.current = canvasRef;\r\n    if (canvasRef) {\r\n      canvasRef.width = canvasRef.offsetWidth;\r\n      canvasRef.height = canvasRef.offsetHeight;\r\n      ctx.current = canvasRef.getContext('2d');\r\n    } else {\r\n      ctx.current = null;\r\n    }\r\n  };\r\n\r\n  let shakeCounter = useRef(0);\r\n  let score = useRef(0);\r\n  let backgroundTimer = useRef(0);\r\n  let timeStarted = useRef(0);\r\n  let roomName = useRef(roomId);\r\n  let gameSelected = useRef(0);\r\n  const drawTrex = (status) => {\r\n    ctx.current.drawImage(cachedCanvas, ...TrexPos[status], 93, 216, 88, 94);\r\n    // console.log(TrexPos[0]);\r\n  };\r\n  const drawTimer = (total) => {\r\n    const now = Date.now();\r\n    const delta = (now - timeStarted.current) / 1000;\r\n    const timeRemain = Math.max(total - ~~delta, 0);\r\n    const timeRemainString = timeRemain.toString().padStart(3, '0');\r\n\r\n    ctx.current.save();\r\n    ctx.current.font = '24px PressStart';\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.fillText(timeRemainString, 11, 35);\r\n    ctx.current.restore();\r\n\r\n    // const timeRemainArray = timeRemainString.split('');\r\n    // timeRemainArray.forEach((num, idx) => {\r\n    //   ctx.current.drawImage(cachedCanvas, ...numPos[num], 11 + 22 * idx, 11, numPos[num][2], numPos[num][3]);\r\n    // })\r\n  };\r\n  const drawFloor = (status) => {\r\n    const targetX = (status) % floorPos[2];\r\n    ctx.current.drawImage(cachedCanvas, targetX, floorPos[1], canvas.current.width, floorPos[3], 0, 294, canvas.current.width, floorPos[3]);\r\n    const remainX = targetX - floorPos[2] + canvas.current.width;\r\n    if (remainX > 0) {\r\n      ctx.current.drawImage(cachedCanvas, floorPos[0], floorPos[1], remainX, floorPos[3], canvas.current.width - remainX, 294, remainX, floorPos[3]);\r\n    }\r\n    // console.log(TrexPos[0]);\r\n  };\r\n  const drawScore = (score) => {\r\n    const scoreString = score.toString().padStart(5, '0');\r\n    ctx.current.save();\r\n    ctx.current.font = '24px PressStart';\r\n    ctx.current.textAlign = \"right\";\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.fillText(scoreString, canvas.current.width - 11, 35);\r\n    ctx.current.restore();\r\n\r\n    // const scoreArray = scoreString.split('');\r\n    // scoreArray.forEach((num, idx) => {\r\n    //   ctx.current.drawImage(cachedCanvas, ...numPos[num], canvas.current.width - 22 * (scoreArray.length - idx + 0.5), 11, numPos[num][2], numPos[num][3]);\r\n    // })\r\n  };\r\n  const drawCloud = (status) => {\r\n    cloudArray.forEach((cloudOffset, idx) => {\r\n      const newX = (canvas.current.width +  2 * cloudPos[2]) - (status * cloudOffset[0] - cloudOffset[2]) % (canvas.current.width +  2 * cloudPos[2]) - 2 * cloudPos[2];\r\n      ctx.current.drawImage(cachedCanvas, ...cloudPos, newX, cloudOffset[1], cloudPos[2], cloudPos[3]);\r\n      if (newX <= -cloudPos[2]) {\r\n        cloudArray[idx] = null;\r\n      }\r\n    })\r\n    cloudArray = cloudArray.filter(el => el !== null);\r\n  };\r\n  const drawBird = (status) => {\r\n    const currentFrame = ~~(status / fps) % birdPos.length;\r\n    birdArray.forEach((birdOffset, idx) => {\r\n      const newX = (canvas.current.width +  2 * birdPos[currentFrame][2]) - (status * birdOffset[0] - birdOffset[2]) % (canvas.current.width +  2 * birdPos[currentFrame][2]) - 2 * birdPos[currentFrame][2];\r\n      ctx.current.drawImage(cachedCanvas, ...birdPos[currentFrame], newX, birdOffset[1], birdPos[currentFrame][2], birdPos[currentFrame][3]);\r\n      if (newX <= -birdPos[currentFrame][2]) {\r\n        birdArray[idx] = null;\r\n      }\r\n    });\r\n    birdArray = birdArray.filter(el => el !== null);\r\n  };\r\n  let prevTime = new Array(5).fill(Date.now());\r\n  const drawCactus = () => {\r\n    const now = Date.now();\r\n    cactusArray.current.forEach((cactus, idx) => {\r\n      const timeDelta = now - prevTime[idx];\r\n      ctx.current.save();\r\n      if (playerJoined.current[idx] !== true) {\r\n        ctx.current.globalAlpha = 0.3;\r\n      }\r\n      if (cactus > 0) {\r\n        const needAnimate = timeDelta >= Math.min(500 / cactus, 200);\r\n        ctx.current.drawImage(cachedCanvas, ...cactusPos, 223 + (80 * idx), 350 - (cactus % 2) * 15, cactusPos[2], cactusPos[3]);\r\n        if (needAnimate) {\r\n          cactusArray.current[idx] -= 1;\r\n          prevTime[idx] = now;\r\n        }\r\n      } else {\r\n        ctx.current.drawImage(cachedCanvas, ...cactusPos, 223 + (80 * idx), 350, cactusPos[2], cactusPos[3]);\r\n      }\r\n      ctx.current.fillStyle = playerColor[idx];\r\n      ctx.current.fillRect(223 + (80 * idx), 410, cactusPos[2], 10);\r\n      ctx.current.restore();\r\n    })\r\n  };\r\n\r\n  const drawQRCode = () => {\r\n    qrcodeArray.current.forEach((qrcode, idx) => {\r\n      ctx.current.drawImage(qrcode, 90 + 120 * idx, (idx % 2 === 0 ? 60: 240));\r\n    });\r\n  };\r\n  \r\n  const drawLanding = () => {\r\n    const qrcode = qrcodeArray.current[2];\r\n    ctx.current.drawImage(qrcode, 325, 210);\r\n    ctx.current.save();\r\n    ctx.current.font = '30px PressStart';\r\n    ctx.current.textAlign = \"center\";\r\n    ctx.current.fillStyle = '#535353';\r\n    // ctx.current.fillStyle = '#FF0000';\r\n    // ctx.current.fillText('Shake Shake Game', canvas.current.width / 2 - 5 + Math.random() * 10, 110 - 5 + Math.random() * 10);\r\n    // ctx.current.fillStyle = '#0000FF';\r\n    // ctx.current.fillText('Shake Shake Game', canvas.current.width / 2 - 5 + Math.random() * 10, 110 - 5 + Math.random() * 10);\r\n    // ctx.current.fillStyle = '#000000';\r\n    ctx.current.fillText('Shake Shake Game', canvas.current.width / 2, 140);\r\n    ctx.current.restore();\r\n  }\r\n  const drawSelecting = () => {\r\n    ctx.current.save();\r\n    ctx.current.font = '30px PressStart';\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.textAlign = \"center\";\r\n    ctx.current.fillText('Select Game', canvas.current.width / 2, canvas.current.height / 2 - 15);\r\n    ctx.current.fillText('on Your Device', canvas.current.width / 2, canvas.current.height / 2 + 45);\r\n    ctx.current.restore();\r\n  }\r\n  \r\n  const drawSelected = () => {\r\n    ctx.current.save();\r\n    ctx.current.font = '30px PressStart';\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.textAlign = \"center\";\r\n    ctx.current.fillText(`Game ${gameSelected.current + 1}`, canvas.current.width / 2, canvas.current.height / 2 + 30);\r\n    ctx.current.restore();\r\n  }\r\n  \r\n  const drawResult = (score) => {\r\n    ctx.current.save();\r\n    ctx.current.font = '30px PressStart';\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.textAlign = \"center\";\r\n    ctx.current.fillText('Score', canvas.current.width / 2, canvas.current.height / 2 - 15);\r\n    ctx.current.fillText(score.toString().padStart(5, '0'), canvas.current.width / 2, canvas.current.height / 2 + 45);\r\n    ctx.current.restore();\r\n  };\r\n\r\n  const drawRoomName = () => {\r\n    ctx.current.save();\r\n    ctx.current.font = '12px PressStart';\r\n    ctx.current.fillStyle = '#535353';\r\n    ctx.current.textAlign = \"left\";\r\n    // ctx.current.fillText('Shake Shake Game', canvas.current.width / 2 - 5 + Math.random() * 10, 120 - 5 + Math.random() * 10);\r\n    ctx.current.fillText(`ID:${roomName.current}`, 16, canvas.current.height - 8);\r\n    ctx.current.restore();\r\n    \r\n  }\r\n  const addScore = (countArray) => {\r\n    countArray.forEach((count, idx) => cactusArray.current[idx] += count * 2);\r\n    const countSum = countArray.reduce((accumulator, currentValue) => accumulator + currentValue);\r\n    score.current += countSum;\r\n    addShakeCounter(countSum);\r\n  };\r\n  const addShakeCounter = (count) => {\r\n    shakeCounter.current += count;\r\n    shakeCounter.current = Math.max(Math.min(shakeCounter.current, 30), 0);\r\n  };\r\n  const trexMultiplier = 1; // 0.01 * fps min, 0.3 * fps max seems good, each shake + 0.01 (5 player shake 6 times in a second will be max)\r\n  const floorMultiplier = 60; // 1 * fps min, 15 * fps max seems good, each shake + 0.5 (5 player shake 6 times in a second will be max)\r\n  const scoreMultiplier = 1; // 0.016 * fps min, 0.3 * fps max seems good, each shake + 0.01 (5 player shake 6 times in a second will be max)\r\n  const cloudMultipler = 10;\r\n  const birdMultipler = 30;\r\n  const render = () => {\r\n    animationFrame.current = requestAnimationFrame(render);\r\n    ctx.current.clearRect(0, 0, canvas.current.width, canvas.current.height);\r\n    drawRoomName();\r\n    switch (gameStage) {\r\n      case gameStatus.idle:\r\n        backgroundTimer.current = 0;\r\n        shakeCounter.current = 0;\r\n        score.current = 0;\r\n        // drawQRCode();\r\n        drawLanding();\r\n        // drawTimer(waitingTimer[gameStage]);\r\n        break;\r\n      case gameStatus.waiting:\r\n        // show qrcode\r\n        // ctx.current.font = \"80px Georgia\";\r\n        // ctx.current.fillText(\"IDLE\", 300, 200);\r\n        backgroundTimer.current = 0;\r\n        shakeCounter.current = 0;\r\n        score.current = 0;\r\n        drawQRCode();\r\n        drawTimer(waitingTimer[gameStage]);\r\n        break;\r\n      case gameStatus.selecting:\r\n        drawTimer(waitingTimer[gameStage]);\r\n        drawSelecting();\r\n        break;\r\n      case gameStatus.selected:\r\n        drawTimer(waitingTimer[gameStage]);\r\n        drawSelected();\r\n        break;\r\n      case gameStatus.ready:\r\n        // get set go\r\n        backgroundTimer.current += 1;\r\n        drawFloor(0);\r\n        if (backgroundTimer.current / fps < 2) {\r\n          drawTrex(~~((backgroundTimer.current / fps) % 10 / 9));\r\n          ctx.current.save();\r\n          ctx.current.font = '30px PressStart';\r\n          ctx.current.fillStyle = '#535353';\r\n          ctx.current.textAlign = \"center\";\r\n          ctx.current.fillText(`Get`, canvas.current.width / 2, canvas.current.height / 2 + 30);\r\n          ctx.current.restore();\r\n        } else {\r\n          drawTrex(6);\r\n          ctx.current.save();\r\n          ctx.current.font = '30px PressStart';\r\n          ctx.current.fillStyle = '#535353';\r\n          ctx.current.textAlign = \"center\";\r\n          ctx.current.fillText(`Set`, canvas.current.width / 2, canvas.current.height / 2 + 30);\r\n          ctx.current.restore();\r\n        }\r\n        drawCactus();\r\n        drawScore(0);\r\n        break;\r\n      case gameStatus.started:\r\n        // playing\r\n        backgroundTimer.current += 0.5 + shakeCounter.current;\r\n        if (shakeCounter.current > 0) {\r\n          addShakeCounter(-Math.max(0.1, shakeCounter.current * 0.01));\r\n        }\r\n        if (backgroundTimer.current / fps < 1) {\r\n          ctx.current.save();\r\n          ctx.current.font = `${30 + 20 * backgroundTimer.current / fps}px PressStart`;\r\n          ctx.current.fillStyle = '#535353';\r\n          ctx.current.textAlign = \"center\";\r\n          ctx.current.fillText(`Go`, canvas.current.width / 2, canvas.current.height / 2 + 30);\r\n          ctx.current.restore();\r\n        }\r\n        // shakeCounter += 30;\r\n        drawFloor((backgroundTimer.current) / fps * floorMultiplier);\r\n        drawCloud((backgroundTimer.current) / fps * cloudMultipler);\r\n        drawBird((backgroundTimer.current) / fps * birdMultipler);\r\n        drawTrex(~~((backgroundTimer.current) / fps * trexMultiplier) % 2 + 2);\r\n        drawCactus();\r\n        drawScore(score.current);\r\n        drawTimer(waitingTimer[gameStage]);\r\n        if (cloudArray.length < 1) {\r\n          cloudArray.push(\r\n            [0.5, Math.random() * 100, (backgroundTimer.current) / fps * cloudMultipler * 0.5]\r\n          );\r\n        }\r\n        if (birdArray.length < 1) {\r\n          birdArray.push(\r\n            [1, 30 + Math.random() * 90, (backgroundTimer.current) / fps * birdMultipler]\r\n          );\r\n        }\r\n        break;\r\n      case gameStatus.result:\r\n        // show result\r\n\r\n        drawResult(score.current);\r\n        drawTimer(waitingTimer[gameStage]);\r\n        // ctx.current.font = \"80px monospace\";\r\n        // ctx.current.fillText(score.current.toString(), 300, 200);\r\n        break;\r\n      case gameStatus.offline:\r\n        // not yet connect to server ?\r\n        break;\r\n    }\r\n    \r\n  };\r\n\r\n  useEffect(() => {\r\n    withSocketio({\r\n      host: config.socketioHost,\r\n      eventEmitters: [\r\n        {\r\n          emitter: 'createRoom',\r\n          data: {\r\n            roomId: roomId\r\n          },\r\n          ack: (newRoomName) => {\r\n            console.log('ack', newRoomName);\r\n            if (newRoomName !== roomId) {\r\n              roomName.current = newRoomName;\r\n              history.push(generatePath(routes.home, {roomId: newRoomName}));\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      eventListeners: [\r\n        {\r\n          listener: 'disconnect',\r\n          callback: () => console.log('disconnect')\r\n        },\r\n        {\r\n          listener: 'roomCreated',\r\n          callback: (newRoomName) => {\r\n            roomName.current = newRoomName;\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameStage',\r\n          callback: (stageId) => {\r\n            setGameStage(stageId);\r\n          }\r\n        },\r\n        {\r\n          listener: 'playersInfo',\r\n          callback: (playersInfo) => {\r\n            qrcodeArray.current.length = 0;\r\n            playersInfo.forEach((playerInfo, idx) => {\r\n              // console.log(playerInfo);\r\n              const dummyCanvas = document.createElement('canvas');\r\n              dummyCanvas.width = 150;\r\n              dummyCanvas.height = 150;\r\n              if (playerInfo['joined'] === false) {\r\n                playerJoined.current[idx] = false;\r\n                // const joinGamePath = window.location.origin + window.location.pathname + '#' + generatePath(routes.mobileHome, {playerId: playerInfo['playerId']});\r\n                const joinGamePath = window.location.origin + generatePath(routes.mobileHome, {playerId: playerInfo['playerId']});\r\n                QRCode.toCanvas(\r\n                  dummyCanvas,\r\n                  joinGamePath,\r\n                  {\r\n                    margin: 0,\r\n                    width: 150,\r\n                    color: {\r\n                      dark: playerColor[idx],\r\n                      // light: '#FFFFFFFF'\r\n                    }\r\n                  }\r\n                );\r\n              } else {\r\n                playerJoined.current[idx] = true;\r\n                const ctx = dummyCanvas.getContext('2d');\r\n                ctx.fillStyle = playerColor[idx];\r\n                ctx.fillRect(0, 0, 150, 150);\r\n                ctx.drawImage(cachedCanvas, ...cactusPos, (150 - cactusPos[2]) / 2, (150 - cactusPos[3]) / 2, cactusPos[2], cactusPos[3]);\r\n              }\r\n              qrcodeArray.current[idx] = dummyCanvas;\r\n            })\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameSelected',\r\n          callback: (gameId) => {\r\n            gameSelected.current = gameId;\r\n          }\r\n        },\r\n        {\r\n          listener: 'playersShake',\r\n          callback: (shakeArray) => {\r\n            addScore(shakeArray);\r\n          }\r\n        },\r\n        {\r\n          listener: 'gameResult',\r\n          callback: (finalScore) => {\r\n            score.current = finalScore;\r\n          }\r\n        }\r\n      ]\r\n    })\r\n    return () => {\r\n      cancelAnimationFrame(animationFrame.current);\r\n    }\r\n  }, []);\r\n  useEffect(() => {\r\n    switch (gameStage) {\r\n      case gameStatus.idle:\r\n      case gameStatus.waiting:\r\n      case gameStatus.ready:\r\n      case gameStatus.started:\r\n        backgroundTimer.current = 0;\r\n        shakeCounter.current = 0;\r\n        score.current = 0;\r\n        cactusArray.current = [0,0,0,0,0];\r\n        timeStarted.current = Date.now();\r\n        break;\r\n      case gameStatus.selecting:\r\n      case gameStatus.selected:\r\n      case gameStatus.result:\r\n        // show result\r\n        timeStarted.current = Date.now();\r\n        break;\r\n      case gameStatus.offline:\r\n    }\r\n    render();\r\n    return () => {\r\n      cancelAnimationFrame(animationFrame.current);\r\n    }\r\n  }, [gameStage]);\r\n\r\n  return <div className={styles.gameCanvasWrapper}>\r\n    <canvas className={styles.gameCanvas} ref={setGameCanvas} />\r\n    {gameStage === gameStatus.idle && \r\n      <div className={styles.fullscreenIcon} title=\"Fullscreen\" onClick={() => canvas.current.requestFullscreen() }/>\r\n    }\r\n  </div>;\r\n}\r\n\r\nexport default GameCanvas;"],"sourceRoot":""}