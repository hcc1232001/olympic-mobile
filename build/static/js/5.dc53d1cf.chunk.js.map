{"version":3,"sources":["components/useDeviceMotion.js","pages/mobileHome.js","pages/mobileHome.module.css","components/withSocketio.js","globals/config.js"],"names":["useDeviceMotion","useState","permissionGranted","setPermissionGranted","moveCounter","setMoveCounter","useEffect","window","addEventListener","updateDeviceStatus","removeEventListener","lastAccVec3","event","acceleration","x","y","z","deltaY","Math","abs","prevMoveCounter","max","gameStatus","MobileHomePage","gameStage","setGameStage","gameSelected","setGameSelected","score","setScore","isJoined","setIsJoined","playerId","useParams","socket","useRef","joinRoom","DeviceOrientationEvent","requestPermission","then","response","catch","console","error","current","withSocketio","host","config","socketioHost","eventEmitters","emitter","data","ack","result","alert","eventListeners","listener","callback","stageId","players","forEach","player","gameIdx","gameId","shake","emit","selectGame","newGameIdx","className","styles","wrapper","joinButton","onClick","selectButton","selected","module","exports","io","secure","on","log"],"mappings":"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","file":"static/js/5.dc53d1cf.chunk.js","sourcesContent":["import React, {useState, useEffect, useRef} from 'react';\r\n\r\nconst useDeviceMotion = () => {\r\n  const [permissionGranted, setPermissionGranted] = useState(false);\r\n  // const [direction, setDirection] = useState(0);\r\n  // const [speed, setSpeed] = useState(0);\r\n  // const [angle, setAngle] = useState(0);\r\n  const [moveCounter, setMoveCounter] = useState(0);\r\n  // let prevAngle = useRef(0);\r\n  // let prevTime = useRef(0);\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      window.addEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n    return () => {\r\n      window.removeEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n  }, [permissionGranted]);\r\n\r\n  let lastAccVec3 = [null, null, null];\r\n  const threshold = 45;\r\n  const updateDeviceStatus = (event) => {\r\n    const {x, y, z} = event.acceleration;\r\n    // const timeDelta = event.interval;\r\n    \r\n    let deltaX = Math.abs(x - lastAccVec3[0]);\r\n    let deltaY = Math.abs(y - lastAccVec3[1]);\r\n    let deltaZ = Math.abs(z - lastAccVec3[2]);\r\n    if(deltaY > threshold) {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return prevMoveCounter + 1;\r\n      })\r\n    } else {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return Math.max(0, prevMoveCounter - 1);\r\n      })\r\n    }\r\n    // setLastAccVec3([alpha, beta, gamma]);\r\n    lastAccVec3 = [x, y, z];\r\n  }\r\n  \r\n  return [{\r\n    // direction, \r\n    // speed, \r\n    // angle,\r\n    moveCounter,\r\n    permissionGranted\r\n  }, {\r\n    setPermissionGranted,\r\n    setMoveCounter\r\n  }];\r\n}\r\n\r\nexport default useDeviceMotion;","import React, { useState, useEffect, useRef } from 'react';\r\nimport {useParams} from 'react-router-dom';\r\n// import useDeviceOrientation from 'components/useDeviceOrientation';\r\nimport useDeviceMotion from 'components/useDeviceMotion';\r\n\r\nimport withSocketio from 'components/withSocketio';\r\n\r\nimport config from 'globals/config';\r\n\r\nimport styles from './mobileHome.module.css';\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\nconst MobileHomePage = () => {\r\n  const [{moveCounter, permissionGranted}, {setMoveCounter, setPermissionGranted}] = useDeviceMotion();\r\n  // const [permissionGranted, setPermissionGranted] = useState(false);\r\n  const [gameStage, setGameStage] = useState(gameStatus['idle']);\r\n  const [gameSelected, setGameSelected] = useState(0);\r\n  const [score, setScore] = useState(0);\r\n  const [isJoined, setIsJoined] = useState(false);\r\n  const playerId = useParams('playerId');\r\n  const socket = useRef(null);\r\n  const requestPermission = () => {\r\n    // setPermissionGranted(true);\r\n    // temp disable\r\n    if (typeof(DeviceOrientationEvent) === \"function\" && typeof(DeviceOrientationEvent.requestPermission) === \"function\") {\r\n      // alert('DeviceOrientationEvent.requestPermission');\r\n      DeviceOrientationEvent.requestPermission().then(response => {\r\n          if (response == 'granted') {\r\n            setPermissionGranted(true);\r\n            // window.addEventListener('deviceorientation', onMotion, false);\r\n            // window.addEventListener('deviceorientation', (e) => {\r\n            //   // do something with e\r\n            // })\r\n          }\r\n        })\r\n        .catch(console.error);\r\n    } else {\r\n      setPermissionGranted(true);\r\n      // alert('no DeviceOrientationEvent.requestPermission');\r\n      // window.addEventListener('deviceorientation', onMotion, false);\r\n    }\r\n  };\r\n  const joinRoom = () => {\r\n    if (!permissionGranted) {\r\n      // setPermissionGranted(true);\r\n      requestPermission();\r\n    } else {\r\n      // socket.current.emit('joinRoom', playerId);\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      socket.current = withSocketio({\r\n        host: config.socketioHost,\r\n        eventEmitters: [\r\n          {\r\n            emitter: 'joinRoom',\r\n            data: playerId,\r\n            ack: (result) => {\r\n              // alert(result);\r\n              if (result === \"failed, scan again\") {\r\n                alert(\"Room not found, please Scan the QRcode again.\")\r\n              }\r\n            }\r\n          }\r\n        ],\r\n        eventListeners: [\r\n          {\r\n            listener: 'gameStage',\r\n            callback: (stageId) => {\r\n              setGameStage(stageId);\r\n              if (stageId === gameStatus.selecting) {\r\n                setGameSelected(0);\r\n              }\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameResult',\r\n            callback: (score) => {\r\n              setScore(score);\r\n            }\r\n          },\r\n          {\r\n            listener: 'playersInfo',\r\n            callback: (players) => {\r\n              players.forEach(player => {\r\n                if (player['playerId'] === playerId['playerId']) {\r\n                  setIsJoined(player['joined']);\r\n                }\r\n              });\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameChoice',\r\n            callback: (gameIdx) => {\r\n              setGameSelected(gameIdx);\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameSelected',\r\n            callback: (gameId) => {\r\n              setGameSelected(gameId);\r\n              // gameSelected.current = gameId;\r\n            }\r\n          },\r\n        ]\r\n      })\r\n    }\r\n  }, [permissionGranted]);\r\n  useEffect(() => {\r\n    if (moveCounter > 2) {\r\n      // socket.current.emit('shake');\r\n      shake();\r\n      setMoveCounter(0);\r\n    }\r\n  }, [moveCounter]);\r\n  const shake = () => {\r\n    socket.current.emit('shake');\r\n  }\r\n  const selectGame = (gameIdx) => {\r\n    socket.current.emit('selectGame', gameIdx, (newGameIdx) => {\r\n      setGameSelected(newGameIdx);\r\n    });\r\n\r\n  }\r\n  return <div className={styles.wrapper}>\r\n    {/* <div>{gameStage} {permissionGranted? 'true': 'false'}</div> */}\r\n    {{\r\n      [gameStatus.idle]: (\r\n        <button className={styles.joinButton} onClick={joinRoom}>Join Game!</button>\r\n      ),\r\n      [gameStatus.waiting]: (\r\n        isJoined?\r\n        <div className={styles.joinButton}>Wait for other players</div>:\r\n        <button className={styles.joinButton} onClick={joinRoom}>Join Game!</button>\r\n      ),\r\n      [gameStatus.selecting]: (\r\n        <div className={styles.joinButton}>\r\n          <button onClick={()=>selectGame(0)} className={styles.selectButton + (gameSelected === 0? ' ' + styles.selected: '')}>Game 1</button>\r\n          <br/>\r\n          <button onClick={()=>selectGame(1)} className={styles.selectButton + (gameSelected === 1? ' ' + styles.selected: '')}>Game 2</button>\r\n          <br/>\r\n          <button onClick={()=>selectGame(2)} className={styles.selectButton + (gameSelected === 2? ' ' + styles.selected: '')}>Game 3</button>\r\n        </div>\r\n      ),\r\n      [gameStatus.selected]: (\r\n        <div className={styles.joinButton}>Game {gameSelected + 1}</div>\r\n      ),\r\n      [gameStatus.ready]: (\r\n        <div className={styles.joinButton}>Ready</div>\r\n      ),\r\n      [gameStatus.started]: (\r\n        <button className={styles.joinButton} onClick={shake}>Shake!</button>\r\n      ),\r\n      [gameStatus.result]: (\r\n        <div className={styles.joinButton}>\r\n          Result\r\n          <div><b>{score}</b></div>\r\n        </div>\r\n      ),\r\n    }[gameStage]}\r\n  </div>;\r\n}\r\n\r\nexport default MobileHomePage;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"mobileHome_wrapper__2dkv9\",\"joinButton\":\"mobileHome_joinButton__2dv24\",\"selectButton\":\"mobileHome_selectButton__13aoe\",\"selected\":\"mobileHome_selected__2QI_z\"};","import io from 'socket.io-client';\r\n\r\nconst withSocketio = ({\r\n  host,\r\n  eventListeners,\r\n  eventEmitters\r\n}) => {\r\n  const socket = io(host, {secure: false});\r\n  \r\n  // console.log(socket);\r\n  \r\n  socket.on('connect', () => {\r\n    console.log('connected !');\r\n    // socket.emit('joinRoom', props.match.match.params.userId);\r\n    // wait join result msg from server\r\n    eventEmitters.forEach(event => {\r\n      const ack = (typeof(event.ack) === \"function\"? event.ack: null);\r\n      socket.emit(event.emitter, event.data, ack);\r\n    });\r\n  });\r\n\r\n  eventListeners.forEach(event => {\r\n    socket.on(event.listener, event.callback);\r\n  });\r\n\r\n  return socket;\r\n}\r\n\r\nexport default withSocketio;","const config = {\r\n  socketioHost: 'shakeshakegame.herokuapp.com',\r\n  // socketioHost: '10.0.1.40:3003',\r\n};\r\n\r\nexport default config;"],"sourceRoot":""}