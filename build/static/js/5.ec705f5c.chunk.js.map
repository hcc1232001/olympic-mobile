{"version":3,"sources":["components/useDeviceMotion.js","pages/mobileHome.js","pages/mobileHome.module.css","components/withSocketio.js","globals/config.js"],"names":["useDeviceMotion","useState","permissionGranted","setPermissionGranted","moveCounter","setMoveCounter","useEffect","window","addEventListener","updateDeviceStatus","removeEventListener","lastAccVec3","prevTime","useRef","event","acceleration","x","y","z","timeNow","Date","now","timeDelta","current","Math","abs","deltaY","prevMoveCounter","max","gameStatus","MobileHomePage","gameStage","setGameStage","gameSelected","setGameSelected","score","setScore","alertText","setAlertText","isJoined","setIsJoined","playerId","useParams","socket","joinRoom","DeviceOrientationEvent","requestPermission","then","response","catch","console","error","withSocketio","host","config","socketioHost","eventEmitters","emitter","data","ack","result","eventListeners","listener","callback","stageId","disconnect","players","forEach","player","gameIdx","gameId","shake","emit","selectGame","newGameIdx","className","styles","wrapper","joinButton","onClick","selectButton","selected","shareToFb","href","location","origin","target","module","exports","io","secure","on","log"],"mappings":"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","file":"static/js/5.ec705f5c.chunk.js","sourcesContent":["import React, {useState, useEffect, useRef} from 'react';\r\n\r\nconst useDeviceMotion = () => {\r\n  const [permissionGranted, setPermissionGranted] = useState(false);\r\n  // const [direction, setDirection] = useState(0);\r\n  // const [speed, setSpeed] = useState(0);\r\n  // const [angle, setAngle] = useState(0);\r\n  const [moveCounter, setMoveCounter] = useState(0);\r\n  // let prevAngle = useRef(0);\r\n  // let prevTime = useRef(0);\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      window.addEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n    return () => {\r\n      window.removeEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n  }, [permissionGranted]);\r\n\r\n  let lastAccVec3 = [null, null, null];\r\n  // let lastAccDir = 0;\r\n  const threshold = 0.5;\r\n  const prevTime = useRef(0);\r\n\r\n  const updateDeviceStatus = (event) => {\r\n    const {x, y, z} = event.acceleration;\r\n    const timeNow = Date.now();\r\n    const timeDelta = timeNow - prevTime.current;\r\n    prevTime.current = timeNow;\r\n    // const timeDelta = event.interval;\r\n    // alert(`${x}, ${y}, ${z}`);\r\n    \r\n    let deltaX = Math.abs(x - lastAccVec3[0]);\r\n    let deltaY = Math.abs(y - lastAccVec3[1]);\r\n    let deltaZ = Math.abs(z - lastAccVec3[2]);\r\n    // let currentAccDir = Math.sign(y - lastAccVec3[1]);\r\n    if (deltaY / timeDelta > threshold) {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return prevMoveCounter + 1;\r\n      })\r\n    } else {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return Math.max(0, prevMoveCounter - 1);\r\n      })\r\n    }\r\n    // setLastAccVec3([alpha, beta, gamma]);\r\n    lastAccVec3 = [x, y, z];\r\n    // lastAccDir = currentAccDir;\r\n  }\r\n  \r\n  return [{\r\n    // direction, \r\n    // speed, \r\n    // angle,\r\n    moveCounter,\r\n    permissionGranted\r\n  }, {\r\n    setPermissionGranted,\r\n    setMoveCounter\r\n  }];\r\n}\r\n\r\nexport default useDeviceMotion;","import React, { useState, useEffect, useRef } from 'react';\r\nimport {useParams} from 'react-router-dom';\r\n// import useDeviceOrientation from 'components/useDeviceOrientation';\r\nimport useDeviceMotion from 'components/useDeviceMotion';\r\n\r\nimport withSocketio from 'components/withSocketio';\r\n\r\nimport config from 'globals/config';\r\n\r\nimport styles from './mobileHome.module.css';\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\nconst MobileHomePage = () => {\r\n  const [{moveCounter, permissionGranted}, {setMoveCounter, setPermissionGranted}] = useDeviceMotion();\r\n  // const [permissionGranted, setPermissionGranted] = useState(false);\r\n  const [gameStage, setGameStage] = useState(gameStatus['idle']);\r\n  const [gameSelected, setGameSelected] = useState(0);\r\n  const [score, setScore] = useState(0);\r\n  const [alertText, setAlertText] = useState('');\r\n  const [isJoined, setIsJoined] = useState(false);\r\n  const playerId = useParams('playerId');\r\n  const socket = useRef(null);\r\n  const requestPermission = () => {\r\n    // setPermissionGranted(true);\r\n    // temp disable\r\n    if (typeof(DeviceOrientationEvent) === \"function\" && typeof(DeviceOrientationEvent.requestPermission) === \"function\") {\r\n      // alert('DeviceOrientationEvent.requestPermission');\r\n      DeviceOrientationEvent.requestPermission().then(response => {\r\n          if (response == 'granted') {\r\n            setPermissionGranted(true);\r\n            // window.addEventListener('deviceorientation', onMotion, false);\r\n            // window.addEventListener('deviceorientation', (e) => {\r\n            //   // do something with e\r\n            // })\r\n          }\r\n        })\r\n        .catch(console.error);\r\n    } else {\r\n      setPermissionGranted(true);\r\n      // alert('no DeviceOrientationEvent.requestPermission');\r\n      // window.addEventListener('deviceorientation', onMotion, false);\r\n    }\r\n  };\r\n  const joinRoom = () => {\r\n    if (!permissionGranted) {\r\n      // setPermissionGranted(true);\r\n      requestPermission();\r\n    } else {\r\n      // socket.current.emit('joinRoom', playerId);\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      socket.current = withSocketio({\r\n        host: config.socketioHost,\r\n        eventEmitters: [\r\n          {\r\n            emitter: 'joinRoom',\r\n            data: playerId,\r\n            ack: (result) => {\r\n              // alert(result);\r\n              if (result !== \"joined\") {\r\n                setGameStage(gameStatus.offline);\r\n                setAlertText(result);\r\n              }\r\n            }\r\n          }\r\n        ],\r\n        eventListeners: [\r\n          {\r\n            listener: 'gameStage',\r\n            callback: (stageId) => {\r\n              setGameStage(stageId);\r\n              if (stageId === gameStatus.selecting) {\r\n                setGameSelected(0);\r\n              } else if (stageId === gameStatus.result) {\r\n                socket.current.disconnect();\r\n              }\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameResult',\r\n            callback: (score) => {\r\n              setScore(score);\r\n            }\r\n          },\r\n          {\r\n            listener: 'playersInfo',\r\n            callback: (players) => {\r\n              players.forEach(player => {\r\n                if (player['playerId'] === playerId['playerId']) {\r\n                  setIsJoined(player['joined']);\r\n                }\r\n              });\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameChoice',\r\n            callback: (gameIdx) => {\r\n              setGameSelected(gameIdx);\r\n            }\r\n          },\r\n          {\r\n            listener: 'gameSelected',\r\n            callback: (gameId) => {\r\n              setGameSelected(gameId);\r\n              // gameSelected.current = gameId;\r\n            }\r\n          },\r\n        ]\r\n      })\r\n    }\r\n  }, [permissionGranted]);\r\n  useEffect(() => {\r\n    if (moveCounter > 2) {\r\n      // socket.current.emit('shake');\r\n      shake();\r\n      setMoveCounter(0);\r\n    }\r\n  }, [moveCounter]);\r\n  const shake = () => {\r\n    socket.current.emit('shake');\r\n  }\r\n  const selectGame = (gameIdx) => {\r\n    socket.current.emit('selectGame', gameIdx, (newGameIdx) => {\r\n      setGameSelected(newGameIdx);\r\n    });\r\n\r\n  }\r\n  return <div className={styles.wrapper}>\r\n    {/* <div>{gameStage} {permissionGranted? 'true': 'false'}</div> */}\r\n    {{\r\n      [gameStatus.idle]: (\r\n        <button className={styles.joinButton} onClick={joinRoom}>Join Game!</button>\r\n      ),\r\n      [gameStatus.waiting]: (\r\n        isJoined?\r\n        <div className={styles.joinButton}>Wait for other players</div>:\r\n        <button className={styles.joinButton} onClick={joinRoom}>Join Game!</button>\r\n      ),\r\n      [gameStatus.selecting]: (\r\n        <div className={styles.joinButton}>\r\n          <button onClick={()=>selectGame(0)} className={styles.selectButton + (gameSelected === 0? ' ' + styles.selected: '')}>Game 1</button>\r\n          <br/>\r\n          <button onClick={()=>selectGame(1)} className={styles.selectButton + (gameSelected === 1? ' ' + styles.selected: '')}>Game 2</button>\r\n          <br/>\r\n          <button onClick={()=>selectGame(2)} className={styles.selectButton + (gameSelected === 2? ' ' + styles.selected: '')}>Game 3</button>\r\n        </div>\r\n      ),\r\n      [gameStatus.selected]: (\r\n        <div className={styles.joinButton}>Game {gameSelected + 1}</div>\r\n      ),\r\n      [gameStatus.ready]: (\r\n        <div className={styles.joinButton}>Ready</div>\r\n      ),\r\n      [gameStatus.started]: (\r\n        <button className={styles.joinButton} onClick={shake}>Shake!</button>\r\n      ),\r\n      [gameStatus.result]: (\r\n        <div className={styles.joinButton}>\r\n          <div>Result</div>\r\n          <div className={styles.score}>{score}</div>\r\n          <a className={styles.shareToFb} href={`https://www.facebook.com/sharer/sharer.php?u=${window.location.origin}&quote=I played Shake Shake Game and got ${score} marks !`} target=\"_blank\">\r\n            Share\r\n          </a>\r\n        </div>\r\n      ),\r\n      [gameStatus.offline]: (\r\n        <div className={styles.joinButton}>\r\n          <div>{alertText}</div>\r\n        </div>\r\n      )\r\n    }[gameStage]}\r\n  </div>;\r\n}\r\n\r\nexport default MobileHomePage;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"mobileHome_wrapper__2dkv9\",\"joinButton\":\"mobileHome_joinButton__2dv24\",\"selectButton\":\"mobileHome_selectButton__13aoe\",\"selected\":\"mobileHome_selected__2QI_z\",\"score\":\"mobileHome_score__3c5ie\",\"shareToFb\":\"mobileHome_shareToFb__2kqms\"};","import io from 'socket.io-client';\r\n\r\nconst withSocketio = ({\r\n  host,\r\n  eventListeners,\r\n  eventEmitters\r\n}) => {\r\n  const socket = io(host, {secure: false});\r\n  \r\n  // console.log(socket);\r\n  \r\n  socket.on('connect', () => {\r\n    console.log('connected !');\r\n    // socket.emit('joinRoom', props.match.match.params.userId);\r\n    // wait join result msg from server\r\n    eventEmitters.forEach(event => {\r\n      const ack = (typeof(event.ack) === \"function\"? event.ack: null);\r\n      socket.emit(event.emitter, event.data, ack);\r\n    });\r\n  });\r\n\r\n  eventListeners.forEach(event => {\r\n    socket.on(event.listener, event.callback);\r\n  });\r\n\r\n  return socket;\r\n}\r\n\r\nexport default withSocketio;","const config = {\r\n  socketioHost: 'shakeshakegame.herokuapp.com',\r\n  // socketioHost: '10.0.1.40:3003',\r\n};\r\n\r\nexport default config;"],"sourceRoot":""}