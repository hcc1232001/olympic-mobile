{"version":3,"sources":["pages/test.js","../node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js"],"names":["MobileHomePage","useState","setMoveCounter","permissionGranted","setPermissionGranted","lastVec3","setLastVec3","eventTimeDelta","setEventTimeDelta","lastAccVec3","prevTime","useRef","updateDeviceStatus","event","acceleration","x","y","z","timeNow","Date","now","timeDelta","current","Math","abs","deltaY","prevMoveCounter","max","useEffect","window","addEventListener","removeEventListener","className","styles","wrapper","joinButton","onClick","DeviceOrientationEvent","requestPermission","then","response","catch","console","error","round","_slicedToArray","arr","i","Array","isArray","Symbol","iterator","Object","prototype","toString","call","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","TypeError"],"mappings":"uJAkGeA,UAnFQ,WAAO,IAAD,EACWC,mBAAS,GADpB,mBACPC,GADO,aAEuBD,oBAAS,GAFhC,mBAEpBE,EAFoB,KAEDC,EAFC,OAGKH,mBAAS,CAAC,EAAE,EAAE,IAHnB,mBAGpBI,EAHoB,KAGVC,EAHU,OAIiBL,mBAAS,GAJ1B,mBAIpBM,EAJoB,KAIJC,EAJI,KAoCvBC,EAAc,CAAC,KAAM,KAAM,MAGzBC,EAAWC,iBAAO,GAElBC,EAAqB,SAACC,GAAW,IAAD,EAClBA,EAAMC,aAAjBC,EAD6B,EAC7BA,EAAGC,EAD0B,EAC1BA,EAAGC,EADuB,EACvBA,EACPC,EAAUC,KAAKC,MACfC,EAAYH,EAAUR,EAASY,QACrCZ,EAASY,QAAUJ,EAINK,KAAKC,IAAIT,EAAIN,EAAY,IAAtC,IACIgB,EAASF,KAAKC,IAAIR,EAAIP,EAAY,IACzBc,KAAKC,IAAIP,EAAIR,EAAY,IAGpCP,EADEuB,EAASJ,EAfG,GAgBC,SAACK,GACd,OAAOA,EAAkB,GAGZ,SAACA,GACd,OAAOH,KAAKI,IAAI,EAAGD,EAAkB,KAGzCpB,EAAY,CAACS,EAAGC,EAAGC,IACnBT,EAAkBa,GAClBZ,EAAc,CAACM,EAAGC,EAAGC,IAWvB,OARAW,qBAAU,WAIR,OAHIzB,GACF0B,OAAOC,iBAAiB,eAAgBlB,GAAoB,GAEvD,WACLiB,OAAOE,oBAAoB,eAAgBnB,GAAoB,MAEhE,CAACT,IACG,yBAAK6B,UAAWC,IAAOC,SAC5B,4BAAQF,UAAWC,IAAOE,WAAYC,QAhDvB,WACVjC,IAnBkC,oBAA5BkC,wBAA+F,oBAA9CA,uBAAuBC,kBAEjFD,uBAAuBC,oBAAoBC,MAAK,SAAAC,GAC5B,WAAZA,GACFpC,GAAqB,MAOxBqC,MAAMC,QAAQC,OAEjBvC,GAAqB,MAqDvB,cACCmB,KAAKqB,MAAoB,IAAdvC,EAAS,IAAa,IAClC,6BACCE,K,gCC3FU,SAASsC,EAAeC,EAAKC,GAC1C,OCJa,SAAyBD,GACtC,GAAIE,MAAMC,QAAQH,GAAM,OAAOA,EDGxB,CAAeA,IEJT,SAA+BA,EAAKC,GACjD,GAAMG,OAAOC,YAAYC,OAAON,IAAgD,uBAAxCM,OAAOC,UAAUC,SAASC,KAAKT,GAAvE,CAIA,IAAIU,EAAO,GACPC,GAAK,EACLC,GAAK,EACLC,OAAKC,EAET,IACE,IAAK,IAAiCC,EAA7BC,EAAKhB,EAAII,OAAOC,cAAmBM,GAAMI,EAAKC,EAAGC,QAAQC,QAChER,EAAKS,KAAKJ,EAAGK,QAETnB,GAAKS,EAAKW,SAAWpB,GAH8CU,GAAK,IAK9E,MAAOW,GACPV,GAAK,EACLC,EAAKS,EACL,QACA,IACOX,GAAsB,MAAhBK,EAAW,QAAWA,EAAW,SAC5C,QACA,GAAIJ,EAAI,MAAMC,GAIlB,OAAOH,GFvBuB,CAAqBV,EAAKC,IGJ3C,WACb,MAAM,IAAIsB,UAAU,wDHG0C,GAJhE","file":"static/js/7.8cb9b592.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {useParams} from 'react-router-dom';\r\n\r\nimport styles from './mobileHome.module.css';\r\n\r\nconst gameStatus = {\r\n  idle:      0,\r\n  waiting:   1,\r\n  selecting: 2,\r\n  selected:  3,\r\n  ready:     4,\r\n  started:   5,\r\n  result:    6,\r\n  offline:   7, // should be not able to get this signal\r\n}\r\nconst MobileHomePage = () => {\r\n  const [moveCounter, setMoveCounter] = useState(0);\r\n  const [permissionGranted, setPermissionGranted] = useState(false);\r\n  const [lastVec3, setLastVec3] = useState([0,0,0]);\r\n  const [eventTimeDelta, setEventTimeDelta] = useState(0);\r\n\r\n  // const [permissionGranted, setPermissionGranted] = useState(false);\r\n  const requestPermission = () => {\r\n    // setPermissionGranted(true);\r\n    // temp disable\r\n    if (typeof(DeviceOrientationEvent) === \"function\" && typeof(DeviceOrientationEvent.requestPermission) === \"function\") {\r\n      // alert('DeviceOrientationEvent.requestPermission');\r\n      DeviceOrientationEvent.requestPermission().then(response => {\r\n          if (response == 'granted') {\r\n            setPermissionGranted(true);\r\n            // window.addEventListener('deviceorientation', onMotion, false);\r\n            // window.addEventListener('deviceorientation', (e) => {\r\n            //   // do something with e\r\n            // })\r\n          }\r\n        })\r\n        .catch(console.error);\r\n    } else {\r\n      setPermissionGranted(true);\r\n      // alert('no DeviceOrientationEvent.requestPermission');\r\n      // window.addEventListener('deviceorientation', onMotion, false);\r\n    }\r\n  };\r\n  const joinRoom = () => {\r\n    if (!permissionGranted) {\r\n      // setPermissionGranted(true);\r\n      requestPermission();\r\n    } else {\r\n      // socket.current.emit('joinRoom', playerId);\r\n    }\r\n  }\r\n  let lastAccVec3 = [null, null, null];\r\n  // let lastAccDir = 0;\r\n  const threshold = 0.5;\r\n  const prevTime = useRef(0);\r\n\r\n  const updateDeviceStatus = (event) => {\r\n    const {x, y, z} = event.acceleration;\r\n    const timeNow = Date.now();\r\n    const timeDelta = timeNow - prevTime.current;\r\n    prevTime.current = timeNow;\r\n    // const timeDelta = event.interval;\r\n    // alert(`${x}, ${y}, ${z}`);\r\n    \r\n    let deltaX = Math.abs(x - lastAccVec3[0]);\r\n    let deltaY = Math.abs(y - lastAccVec3[1]);\r\n    let deltaZ = Math.abs(z - lastAccVec3[2]);\r\n    // let currentAccDir = Math.sign(y - lastAccVec3[1]);\r\n    if (deltaY / timeDelta > threshold) {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return prevMoveCounter + 1;\r\n      })\r\n    } else {\r\n      setMoveCounter((prevMoveCounter) => {\r\n        return Math.max(0, prevMoveCounter - 1);\r\n      })\r\n    }\r\n    setLastVec3([x, y, z]);\r\n    setEventTimeDelta(timeDelta);\r\n    lastAccVec3 = [x, y, z];\r\n    // lastAccDir = currentAccDir;\r\n  }\r\n  useEffect(() => {\r\n    if (permissionGranted) {\r\n      window.addEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n    return () => {\r\n      window.removeEventListener('devicemotion', updateDeviceStatus, false);\r\n    }\r\n  }, [permissionGranted]);\r\n  return <div className={styles.wrapper}>\r\n    <button className={styles.joinButton} onClick={joinRoom}>Join Game!</button>\r\n    {Math.round(lastVec3[1] * 1000) / 1000}\r\n    <br/>\r\n    {eventTimeDelta}\r\n  </div>;\r\n}\r\n\r\nexport default MobileHomePage;","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}"],"sourceRoot":""}